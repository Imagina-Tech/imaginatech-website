<!-- 
==================================================
ARQUIVO: servicos/index.html
MÓDULO: Serviços/Produção (Painel Administrativo)
SISTEMA: ImaginaTech - Gestão de Impressão 3D
VERSÃO: 2.2 - Optimized
IMPORTANTE: NÃO REMOVER ESTE CABEÇALHO DE IDENTIFICAÇÃO
==================================================
-->
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Serviços - ImaginaTech Admin</title>
    <meta name="description" content="Painel administrativo de serviços - ImaginaTech">
    <meta name="robots" content="noindex, nofollow">
    
    <!-- Favicons -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;900&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text">Conectando ao servidor...</div>
        </div>
    </div>

    <!-- Background Effects -->
    <div class="cosmic-bg">
        <div class="grid-lines"></div>
        <div class="particles" id="particles"></div>
    </div>

    <!-- Login Screen -->
    <div class="login-screen hidden" id="loginScreen">
        <div class="login-container">
            <div class="login-header">
                <div class="login-logo">
                    <h1>ImaginaTech</h1>
                    <p>Painel Administrativo</p>
                </div>
                <div class="login-info">
                    <i class="fas fa-shield-alt"></i>
                    <h2>Acesso Restrito</h2>
                    <p>Área exclusiva para funcionários autorizados</p>
                </div>
            </div>
            <button class="btn-google" onclick="signInWithGoogle()">
                <i class="fab fa-google"></i>
                <span>Entrar com Google</span>
            </button>
            <div class="login-footer">
                <p class="footer-text">Cliente? Acompanhe seu pedido:</p>
                <a href="https://imaginatech.com.br" class="client-link" target="_blank">
                    <i class="fas fa-cube"></i>
                    Portal do Cliente
                </a>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div class="admin-dashboard hidden" id="adminDashboard">
        <!-- Header -->
        <header class="navbar">
            <div class="navbar-container">
                <div class="navbar-left">
                    <div class="logo-section">
                        <h1 class="logo">ImaginaTech</h1>
                        <span class="logo-subtitle">Painel de Serviços</span>
                    </div>
                    <div class="connection-status" id="connectionStatus">
                        <div class="status-dot"></div>
                        <span id="statusText">Conectado</span>
                    </div>
                </div>
                <div class="navbar-right">
                    <div class="user-info" id="userInfo">
                        <img id="userPhoto" class="user-photo" alt="Foto" src="/assets/default-avatar.png">
                        <div class="user-details">
                            <span class="user-name" id="userName">Carregando...</span>
                            <span class="user-role">Administrador</span>
                        </div>
                    </div>
                    <button class="btn-logout" onclick="signOut()">
                        <i class="fas fa-sign-out-alt"></i>
                        <span class="btn-text">Sair</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <div class="container">
                <!-- Action Bar -->
                <div class="action-bar">
                    <h2 class="page-title">
                        <i class="fas fa-tasks"></i>
                        Gerenciamento de Serviços
                    </h2>
                    <div class="action-buttons">
                        <button class="btn-primary" onclick="openAddModal()">
                            <i class="fas fa-plus"></i>
                            Novo Serviço
                        </button>
                    </div>
                </div>

                <!-- Statistics Cards -->
                <div class="stats-grid">
                    <div class="stat-card clickable" onclick="filterServices('todos')">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #667eea, #764ba2);">
                            <i class="fas fa-list"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number" id="stat-active">0</div>
                            <div class="stat-label">Serviços Ativos</div>
                        </div>
                    </div>
                    <div class="stat-card clickable" onclick="filterServices('pendente')">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #f093fb, #f5576c);">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number" id="stat-pending">0</div>
                            <div class="stat-label">Pendentes</div>
                        </div>
                    </div>
                    <div class="stat-card clickable" onclick="filterServices('producao')">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #4facfe, #00f2fe);">
                            <i class="fas fa-cogs"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number" id="stat-production">0</div>
                            <div class="stat-label">Em Produção</div>
                        </div>
                    </div>
                    <div class="stat-card clickable" onclick="filterServices('concluido')">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #43e97b, #38f9d7);">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number" id="stat-completed">0</div>
                            <div class="stat-label">Concluídos</div>
                        </div>
                    </div>
                    <div class="stat-card clickable" onclick="filterServices('retirada')">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #fa709a, #fee140);">
                            <i class="fas fa-box-open"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number" id="stat-ready">0</div>
                            <div class="stat-label">Para Retirada</div>
                        </div>
                    </div>
                    <div class="stat-card clickable" onclick="filterServices('entregue')">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #30cfd0, #330867);">
                            <i class="fas fa-handshake"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number" id="stat-delivered">0</div>
                            <div class="stat-label">Entregues</div>
                        </div>
                    </div>
                </div>

                <!-- Services Grid -->
                <div class="services-grid" id="servicesGrid"></div>

                <!-- Empty State -->
                <div class="empty-state" id="emptyState">
                    <div class="empty-icon"><i class="fas fa-inbox"></i></div>
                    <h3>Nenhum serviço encontrado</h3>
                    <p id="emptyText">Clique no botão abaixo para adicionar seu primeiro serviço</p>
                    <button class="btn-primary" onclick="openAddModal()">
                        <i class="fas fa-plus"></i>
                        Adicionar Serviço
                    </button>
                </div>
            </div>
        </main>
    </div>

    <!-- Service Modal -->
    <div class="modal" id="serviceModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Novo Serviço</h2>
                <button class="modal-close" onclick="closeModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="serviceForm" onsubmit="saveService(event)">
                <div class="form-grid">
                    <!-- Order Code Display -->
                    <div class="order-code-display" id="orderCodeDisplay" style="display: none; grid-column: 1 / -1;">
                        <div class="order-code-label">Código do Pedido</div>
                        <div class="order-code-value" id="orderCodeValue">-</div>
                        <div class="order-code-info">Guarde este código para acompanhamento</div>
                    </div>

                    <!-- Basic Info -->
                    <div class="form-group">
                        <label for="serviceName"><i class="fas fa-cube"></i> Nome do Serviço *</label>
                        <input type="text" id="serviceName" class="form-input" required autocomplete="off">
                    </div>
                    <div class="form-group">
                        <label for="clientName"><i class="fas fa-user"></i> Nome do Cliente *</label>
                        <input type="text" id="clientName" class="form-input" required autocomplete="off">
                    </div>
                    <div class="form-group">
                        <label for="clientEmail"><i class="fas fa-envelope"></i> E-mail do Cliente</label>
                        <input type="email" id="clientEmail" class="form-input" autocomplete="off">
                    </div>
                    <div class="form-group">
                        <label for="clientPhone"><i class="fas fa-phone"></i> WhatsApp do Cliente</label>
                        <input type="tel" id="clientPhone" class="form-input" placeholder="(11) 99999-9999" autocomplete="off">
                    </div>

                    <!-- Material & Color -->
                    <div class="form-group">
                        <label for="serviceMaterial"><i class="fas fa-layer-group"></i> Material *</label>
                        <select id="serviceMaterial" class="form-select" required>
                            <option value="">Selecione o material</option>
                            <option value="PLA">PLA</option>
                            <option value="ABS">ABS</option>
                            <option value="PETG">PETG</option>
                            <option value="TPU">TPU</option>
                            <option value="Resina">Resina</option>
                            <option value="Nylon">Nylon</option>
                            <option value="Outros">Outros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="serviceColor"><i class="fas fa-palette"></i> Cor</label>
                        <select id="serviceColor" class="form-select">
                            <option value="">Selecione a cor</option>
                            <option value="preto">Preto</option>
                            <option value="branco">Branco</option>
                            <option value="vermelho">Vermelho</option>
                            <option value="azul">Azul</option>
                            <option value="verde">Verde</option>
                            <option value="amarelo">Amarelo</option>
                            <option value="laranja">Laranja</option>
                            <option value="roxo">Roxo</option>
                            <option value="cinza">Cinza</option>
                            <option value="transparente">Transparente</option>
                            <option value="outros">Outras</option>
                        </select>
                    </div>

                    <!-- Delivery & Priority -->
                    <div class="form-group">
                        <label for="deliveryMethod"><i class="fas fa-truck"></i> Método de Entrega *</label>
                        <select id="deliveryMethod" class="form-select" required onchange="toggleDeliveryFields()">
                            <option value="">Selecione o método</option>
                            <option value="retirada">Retirada no Local</option>
                            <option value="sedex">Sedex/Correios</option>
                            <option value="uber">Uber Flash</option>
                            <option value="definir">A Definir</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="servicePriority"><i class="fas fa-flag"></i> Prioridade *</label>
                        <select id="servicePriority" class="form-select" required>
                            <option value="baixa">Baixa</option>
                            <option value="media" selected>Média</option>
                            <option value="alta">Alta</option>
                            <option value="urgente">Urgente</option>
                        </select>
                    </div>

                    <!-- Dates -->
                    <div class="form-group">
                        <label for="startDate"><i class="fas fa-calendar-plus"></i> Data de Início *</label>
                        <input type="date" id="startDate" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label for="dueDate"><i class="fas fa-calendar-check"></i> Prazo de Entrega *</label>
                        <div class="input-group">
                            <input type="date" id="dueDate" class="form-input" required>
                            <label class="checkbox-label">
                                <input type="checkbox" id="dateUndefined" onchange="toggleDateInput()">
                                <span>Data ainda a definir</span>
                            </label>
                        </div>
                    </div>

                    <!-- Value & Weight -->
                    <div class="form-group">
                        <label for="serviceValue"><i class="fas fa-dollar-sign"></i> Valor (R$)</label>
                        <input type="number" id="serviceValue" class="form-input" step="0.01" min="0" placeholder="0,00">
                    </div>
                    <div class="form-group">
                        <label for="serviceWeight"><i class="fas fa-weight"></i> Peso (gramas)</label>
                        <input type="number" id="serviceWeight" class="form-input" min="0" placeholder="0">
                    </div>

                    <!-- File Upload -->
                    <div class="form-group full-width">
                        <label for="serviceFile"><i class="fas fa-file-upload"></i> Arquivo do Projeto (STL, OBJ, STEP, 3MF)</label>
                        <div class="file-input-wrapper">
                            <input type="file" id="serviceFile" accept=".stl,.obj,.step,.stp,.3mf" onchange="handleFileSelect(event)">
                            <div class="file-info" id="fileInfo" style="display: none;">
                                <i class="fas fa-file"></i>
                                <span id="fileName"></span>
                                <button type="button" class="btn-remove-file" onclick="removeFile()">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Image Upload -->
                    <div class="form-group full-width">
                        <label for="serviceImage"><i class="fas fa-image"></i> Imagem de Referência</label>
                        <div class="image-input-wrapper">
                            <input type="file" id="serviceImage" accept="image/*" onchange="handleImageSelect(event)">
                            <div class="image-preview" id="imagePreview" style="display: none;">
                                <img id="previewImg" src="" alt="Preview">
                                <button type="button" class="btn-remove-image" onclick="removeImage()">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Pickup Fields -->
                    <div class="pickup-fields" id="pickupFields">
                        <h4 class="section-title"><i class="fas fa-store"></i> Informações para Retirada</h4>
                        <div class="form-group">
                            <label for="pickupName">Nome de quem vai retirar *</label>
                            <input type="text" id="pickupName" class="form-input" placeholder="Nome completo">
                        </div>
                        <div class="form-group">
                            <label for="pickupWhatsapp">WhatsApp para contato *</label>
                            <input type="tel" id="pickupWhatsapp" class="form-input" placeholder="(11) 99999-9999">
                        </div>
                    </div>

                    <!-- Delivery Fields (Sedex) -->
                    <div class="delivery-fields" id="deliveryFields">
                        <h4 class="section-title"><i class="fas fa-shipping-fast"></i> Dados para Entrega</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="fullName">Nome Completo *</label>
                                <input type="text" id="fullName" class="form-input">
                            </div>
                            <div class="form-group">
                                <label for="cpfCnpj">CPF/CNPJ *</label>
                                <input type="text" id="cpfCnpj" class="form-input">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="email">E-mail *</label>
                                <input type="email" id="email" class="form-input">
                            </div>
                            <div class="form-group">
                                <label for="telefone">Telefone *</label>
                                <input type="tel" id="telefone" class="form-input">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="cep">CEP *</label>
                                <input type="text" id="cep" class="form-input" maxlength="9" onblur="buscarCEP()">
                            </div>
                            <div class="form-group">
                                <label for="estado">Estado *</label>
                                <input type="text" id="estado" class="form-input">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="cidade">Cidade *</label>
                            <input type="text" id="cidade" class="form-input">
                        </div>
                        <div class="form-group">
                            <label for="bairro">Bairro *</label>
                            <input type="text" id="bairro" class="form-input">
                        </div>
                        <div class="form-row">
                            <div class="form-group" style="flex: 3;">
                                <label for="rua">Rua *</label>
                                <input type="text" id="rua" class="form-input">
                            </div>
                            <div class="form-group" style="flex: 1;">
                                <label for="numero">Número *</label>
                                <input type="text" id="numero" class="form-input">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="complemento">Complemento</label>
                            <input type="text" id="complemento" class="form-input" placeholder="Apto, Bloco, etc">
                        </div>
                        
                        <!-- Campo de Código de Rastreio (aparece apenas ao editar) -->
                        <div class="form-group" id="trackingCodeField" style="display: none;">
                            <label for="editTrackingCode">
                                <i class="fas fa-barcode"></i> Código de Rastreio (Correios)
                            </label>
                            <input type="text" id="editTrackingCode" class="form-input" 
                                   placeholder="Ex: BR123456789BR" 
                                   style="text-transform: uppercase;">
                            <small style="color: var(--text-secondary); font-size: 0.8rem;">
                                Digite o código de rastreio dos Correios para este pedido
                            </small>
                        </div>
                    </div>

                    <!-- Description & Observations -->
                    <div class="form-group full-width">
                        <label for="serviceDescription"><i class="fas fa-align-left"></i> Descrição do Serviço</label>
                        <textarea id="serviceDescription" class="form-textarea" rows="3" placeholder="Detalhes sobre o serviço..." autocomplete="off"></textarea>
                    </div>
                    <div class="form-group full-width">
                        <label for="serviceObservations"><i class="fas fa-exclamation-triangle"></i> Observações</label>
                        <textarea id="serviceObservations" class="form-textarea" rows="2" placeholder="Observações importantes..." autocomplete="off"></textarea>
                    </div>
                </div>

                <!-- Hidden Fields -->
                <input type="hidden" id="serviceId">
                <input type="hidden" id="serviceStatus" value="pendente">
                <input type="hidden" id="currentFileUrl">
                <input type="hidden" id="currentFileName">
                <input type="hidden" id="currentImageUrl">

                <div class="modal-footer">
                    <button type="button" class="btn-cancel" onclick="closeModal()">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                    <button type="submit" class="btn-save">
                        <i class="fas fa-save"></i>
                        <span id="saveButtonText">Salvar Serviço</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Tracking Modal -->
    <div class="modal" id="trackingModal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>Código de Rastreio</h2>
                <button class="modal-close" onclick="closeTrackingModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p>Digite o código de rastreio dos Correios:</p>
                <input type="text" id="trackingCode" placeholder="Ex: BR123456789BR" required>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-cancel" onclick="closeTrackingModal()">
                    <i class="fas fa-times"></i> Cancelar
                </button>
                <button type="button" class="btn-confirm" onclick="confirmTrackingCode()">
                    <i class="fas fa-check"></i> Confirmar
                </button>
            </div>
        </div>
    </div>

    <!-- Delivery Info Modal -->
    <div class="modal" id="deliveryInfoModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title"><i class="fas fa-truck"></i> Informações de Entrega</h2>
                <button class="modal-close" onclick="closeDeliveryModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="deliveryInfoContent" class="modal-body"></div>
            <div class="modal-footer">
                <button class="btn-primary" onclick="closeDeliveryModal()">
                    <i class="fas fa-check"></i> Fechar
                </button>
            </div>
        </div>
    </div>

    <!-- Status Confirmation Modal -->
    <div class="modal" id="statusModal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>Confirmar Mudança de Status</h2>
                <button class="modal-close" onclick="closeStatusModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p id="statusModalMessage">Deseja alterar o status deste serviço?</p>
                <div class="whatsapp-option" id="whatsappOption" style="display: none;">
                    <label class="checkbox-label">
                        <input type="checkbox" id="sendWhatsappNotification">
                        <span>Notificar cliente via WhatsApp</span>
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="closeStatusModal()">
                    <i class="fas fa-times"></i> Cancelar
                </button>
                <button class="btn-confirm" onclick="confirmStatusChange()">
                    <i class="fas fa-check"></i> Confirmar
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

    <!-- Scripts -->
    <script src="scripts.js"></script>
    <script>
        // Particles Animation
        function createParticles() {
            const container = document.getElementById('particles');
            if (!container) return;
            const count = window.innerWidth < 768 ? 15 : 30;
            for (let i = 0; i < count; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.cssText = `left:${Math.random()*100}%;animation-delay:${Math.random()*20}s;animation-duration:${20+Math.random()*10}s`;
                container.appendChild(particle);
            }
        }
        window.addEventListener('DOMContentLoaded', createParticles);
    </script>
</body>
</html>
