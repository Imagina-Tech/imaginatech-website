<!--
==================================================
ARQUIVO: admin-portfolio/index.html
MODULO: Gerenciamento de Portfolio
SISTEMA: ImaginaTech - Gestao de Impressao 3D
VERSAO: 1.0
IMPORTANTE: NAO REMOVER ESTE CABECALHO DE IDENTIFICACAO
==================================================
-->
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio - ImaginaTech Admin</title>
    <meta name="description" content="Gerenciamento de portfolio - ImaginaTech">
    <meta name="robots" content="noindex, nofollow">

    <!-- Content Security Policy -->
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self' https://www.gstatic.com https://apis.google.com https://accounts.google.com https://static.cloudflareinsights.com;
        style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com;
        font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com;
        img-src 'self' https: data: blob:;
        connect-src 'self' https://*.firebaseio.com https://*.googleapis.com https://www.gstatic.com https://firestore.googleapis.com https://identitytoolkit.googleapis.com https://securetoken.googleapis.com wss://*.firebaseio.com;
        frame-src 'self' https://accounts.google.com https://*.firebaseapp.com;
        object-src 'none';
        base-uri 'self';
    ">

    <!-- Open Graph / WhatsApp Preview -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://imaginatech.com.br/admin-portfolio/">
    <meta property="og:title" content="Portfolio - ImaginaTech">
    <meta property="og:description" content="Sistema de gerenciamento de portfolio - ImaginaTech">
    <meta property="og:image" content="https://imaginatech.com.br/iconwpp.jpg">

    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;900&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Estilos base compartilhados -->
    <link rel="stylesheet" href="/servicos/styles.css">
    <!-- CSS Compartilhado - /shared -->
    <link rel="stylesheet" href="/shared/auth-screen.css">
    <link rel="stylesheet" href="/shared/access-denied.css">
    <link rel="stylesheet" href="/shared/loading.css">
    <link rel="stylesheet" href="/shared/buttons.css">
    <link rel="stylesheet" href="/shared/navbar.css">
    <link rel="stylesheet" href="/shared/navbar-mobile.css">
    <link rel="stylesheet" href="/shared/z-index.css">
    <!-- Customizacoes do modulo Portfolio -->
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text" id="loadingText">Carregando portfolio...</div>
        </div>
    </div>

    <div class="cosmic-bg">
        <div class="grid-lines"></div>
        <div class="particles" id="particles"></div>
    </div>

    <!-- Tela de Login -->
    <div class="auth-screen" id="loginScreen">
        <div class="auth-content">
            <div class="auth-logo">
                <h1>ImaginaTech</h1>
                <p>Gerenciar Portfolio</p>
            </div>
            <div class="auth-icon">
                <i class="fas fa-images"></i>
            </div>
            <h2 class="auth-title">Acesso Restrito</h2>
            <p class="auth-message">
                Area exclusiva para funcionarios autorizados da ImaginaTech.
            </p>
            <button class="auth-btn-google" data-action="sign-in-google">
                <i class="fab fa-google"></i>
                <span>Entrar com Google</span>
            </button>
            <div class="auth-footer">
                <p>Cliente? <a href="/">Voltar ao site</a></p>
            </div>
        </div>
    </div>

    <!-- Tela de Acesso Negado -->
    <div class="access-denied-screen" id="accessDeniedScreen">
        <div class="access-denied-content">
            <div class="access-denied-icon">
                <i class="fas fa-lock"></i>
            </div>
            <h1 class="access-denied-title">Acesso Restrito</h1>
            <p class="access-denied-message" id="deniedMessage">
                Esta area e exclusiva para administradores.
            </p>
            <p class="access-denied-submessage">
                O gerenciamento de portfolio requer permissao especial de acesso.
            </p>
            <div class="access-denied-user">
                <i class="fas fa-user-slash"></i>
                <span id="deniedUserEmail">email@exemplo.com</span>
            </div>
            <div class="access-denied-actions">
                <a href="/" class="access-denied-btn btn-primary">
                    <i class="fas fa-home"></i>
                    Voltar ao Inicio
                </a>
                <a href="/acompanhar-pedido/" class="access-denied-btn btn-secondary">
                    <i class="fas fa-cube"></i>
                    Acompanhar Pedido
                </a>
            </div>
            <button class="access-denied-btn btn-logout" data-action="sign-out">
                <i class="fas fa-sign-out-alt"></i>
                Fazer Logout
            </button>
        </div>
    </div>

    <!-- Dashboard -->
    <div class="dashboard hidden" id="dashboard">
        <header class="navbar">
            <div class="navbar-container">
                <div class="navbar-left">
                    <div class="logo-section">
                        <h1 class="logo">ImaginaTech</h1>
                        <span class="logo-subtitle">Gerenciar Portfolio</span>
                    </div>
                    <div class="connection-status" id="connectionStatus">
                        <div class="status-dot"></div>
                        <span id="statusText">Conectado</span>
                    </div>
                </div>
                <div class="navbar-right">
                    <div class="nav-buttons-desktop">
                        <a href="/projetos/" class="btn-nav" target="_blank" title="Ver Projetos">
                            <i class="fas fa-eye"></i>
                        </a>
                        <a href="/servicos/" class="btn-nav" title="Servicos">
                            <i class="fas fa-tasks"></i>
                        </a>
                        <a href="/estoque/" class="btn-nav" title="Estoque">
                            <i class="fas fa-box-open"></i>
                        </a>
                        <a href="/financas/" class="btn-nav" title="Financas">
                            <i class="fas fa-wallet"></i>
                        </a>
                        <a href="/marketplace/" class="btn-nav" title="Marketplace">
                            <i class="fas fa-store"></i>
                        </a>
                    </div>
                    <button class="btn-nav btn-mobile-menu" id="btnMobileMenu" data-action="toggle-mobile-menu">
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="user-info" id="userInfo">
                        <img id="userPhoto" class="user-photo" alt="Foto">
                        <div class="user-details">
                            <span class="user-name" id="userName">Carregando...</span>
                            <span class="user-role">Administrador</span>
                        </div>
                    </div>
                    <button class="btn-nav btn-logout" data-action="sign-out" title="Sair">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- Menu dropdown mobile -->
        <div class="mobile-nav-dropdown" id="mobileNavDropdown">
            <a href="/projetos/" class="mobile-nav-item" target="_blank">
                <i class="fas fa-eye"></i>
                <span>Ver Projetos</span>
            </a>
            <a href="/servicos/" class="mobile-nav-item">
                <i class="fas fa-tasks"></i>
                <span>Servicos</span>
            </a>
            <a href="/estoque/" class="mobile-nav-item">
                <i class="fas fa-box-open"></i>
                <span>Estoque</span>
            </a>
            <a href="/financas/" class="mobile-nav-item">
                <i class="fas fa-wallet"></i>
                <span>Financas</span>
            </a>
            <a href="/marketplace/" class="mobile-nav-item">
                <i class="fas fa-store"></i>
                <span>Marketplace</span>
            </a>
        </div>

        <main class="main-content">
            <div class="container">
                <!-- Stats Bar (filtros por nivel de publicacao) -->
                <div class="portfolio-stats">
                    <button class="stat-card active" data-filter="todos">
                        <div class="stat-icon">
                            <i class="fas fa-images"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="totalItems">0</span>
                            <span class="stat-label">Total</span>
                        </div>
                    </button>
                    <button class="stat-card qap" data-filter="qap">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="qapItems">0</span>
                            <span class="stat-label">QAP</span>
                        </div>
                    </button>
                    <button class="stat-card projetos" data-filter="published">
                        <div class="stat-icon">
                            <i class="fas fa-globe"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="publishedItems">0</span>
                            <span class="stat-label">/projetos/</span>
                        </div>
                    </button>
                    <button class="stat-card grid" data-filter="grid">
                        <div class="stat-icon">
                            <i class="fas fa-th-large"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="gridItems">0</span>
                            <span class="stat-label">Grid</span>
                        </div>
                    </button>
                    <button class="stat-card carrossel" data-filter="featured">
                        <div class="stat-icon">
                            <i class="fas fa-star"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="featuredItems">0</span>
                            <span class="stat-label">Hero</span>
                        </div>
                    </button>
                </div>

                <!-- Search Bar & Add Button -->
                <div class="portfolio-filters">
                    <div class="search-wrapper">
                        <i class="fas fa-search"></i>
                        <input type="text" id="searchInput" placeholder="Buscar por titulo...">
                    </div>
                    <button class="btn-add-new" data-action="open-add-modal">
                        <i class="fas fa-plus"></i>
                        <span>Novo Item</span>
                    </button>
                </div>

                <!-- Portfolio Grid -->
                <div class="portfolio-grid" id="portfolioGrid">
                    <!-- Items serao inseridos aqui -->
                </div>

                <!-- Empty State -->
                <div class="empty-state" id="emptyState" style="display: none;">
                    <i class="fas fa-images"></i>
                    <h3>Nenhum item no portfolio</h3>
                    <p>Use o botao "Up" nos servicos para adicionar itens</p>
                </div>
            </div>
        </main>
    </div>

    <!-- Edit Modal -->
    <div class="modal" id="editModal" role="dialog" aria-modal="true" aria-labelledby="modalTitle" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle"><i class="fas fa-plus"></i> Novo Item</h2>
                <button class="modal-close" data-action="close-edit-modal" aria-label="Fechar modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <!-- Service Link Dropdown (opcional) -->
                <div class="form-group full-width service-link-section">
                    <label><i class="fas fa-link"></i> Atrelar a um Servico (opcional)</label>
                    <select id="editServiceLink" class="form-select" data-action="service-link-change">
                        <option value="">Nenhum - Item avulso</option>
                        <!-- Servicos serao carregados aqui -->
                    </select>
                    <small class="form-hint">Vincule este item a um servico existente</small>
                </div>

                <!-- Opcao de herdar foto do servico -->
                <div class="form-group full-width inherit-photo-section hidden" id="inheritPhotoSection">
                    <label class="checkbox-label">
                        <input type="checkbox" id="inheritServicePhoto" class="form-checkbox" data-action="toggle-inherit-photo">
                        <span class="checkbox-custom"></span>
                        <span class="checkbox-text"><i class="fas fa-clone"></i> Usar foto do servico</span>
                    </label>
                    <div class="inherit-photo-preview hidden" id="inheritPhotoPreview">
                        <img id="inheritPhotoImg" src="" alt="Foto do servico">
                        <span>Esta foto sera usada</span>
                    </div>
                </div>

                <div class="form-grid">
                    <!-- Photo -->
                    <div class="form-group full-width">
                        <label><i class="fas fa-camera"></i> Foto Principal</label>
                        <div class="photo-upload-wrapper">
                            <div class="image-upload-box" id="editPhotoArea">
                                <input type="file" id="editPhoto" accept="image/jpeg,image/png,image/webp,image/gif" multiple data-action="photo-select" style="display: none;">
                                <div class="upload-placeholder" id="editPhotoPlaceholder">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <span class="upload-text">Arraste imagens ou clique para selecionar</span>
                                    <span class="upload-hint">Arraste varias fotos de uma vez! A primeira sera a principal</span>
                                    <div class="upload-formats">
                                        <span class="format-badge">JPG</span>
                                        <span class="format-badge">PNG</span>
                                        <span class="format-badge">WebP</span>
                                        <span class="format-badge multi-badge">MULTIPLAS</span>
                                    </div>
                                </div>
                                <div class="image-preview hidden" id="editPhotoPreview">
                                    <img id="editPhotoImg" src="" alt="Preview">
                                    <button type="button" class="btn-remove-img" data-action="remove-photo" aria-label="Remover foto">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                            <button type="button" class="btn-open-gallery" data-action="open-gallery" data-mode="main">
                                <i class="fas fa-images"></i>
                                <span>Escolher do Banco</span>
                            </button>
                        </div>
                    </div>

                    <!-- Extra Photos (sempre visivel) -->
                    <div class="form-group full-width" id="editExtraPhotosGroup">
                        <label><i class="fas fa-images"></i> Fotos Extras <span class="extra-photos-hint">(aparecem quando o projeto esta aberto)</span></label>
                        <small class="form-hint">Fotos adicionais para a galeria do projeto - maximo 5</small>
                        <div class="extra-photos-grid" id="editExtraPhotosGrid">
                            <!-- Fotos extras existentes e novos slots serao inseridos aqui -->
                        </div>
                        <div class="extra-photos-actions">
                            <button type="button" class="btn-add-extra-photo" data-action="add-extra-photo-slot">
                                <i class="fas fa-plus"></i> Adicionar Foto
                            </button>
                            <button type="button" class="btn-open-gallery-extra" data-action="open-gallery" data-mode="extra">
                                <i class="fas fa-photo-video"></i> Escolher do Banco
                            </button>
                        </div>
                    </div>

                    <!-- Title -->
                    <div class="form-group full-width">
                        <label><i class="fas fa-heading"></i> Titulo *</label>
                        <input type="text" id="editTitle" class="form-input" placeholder="Titulo do projeto">
                    </div>

                    <!-- Description -->
                    <div class="form-group full-width" id="editDescriptionGroup">
                        <label><i class="fas fa-align-left"></i> Descricao <span id="descRequiredBadge" class="required-badge" style="display: none;">* obrigatorio para destaque</span></label>
                        <textarea id="editDescription" class="form-input form-textarea" rows="3"
                                  placeholder="Descricao do projeto - aparece no modal de detalhes"></textarea>
                        <small class="form-hint">Obrigatoria para aparecer no carrossel hero</small>
                    </div>

                    <!-- Category -->
                    <div class="form-group" id="editCategoryGroup">
                        <label><i class="fas fa-tag"></i> Categoria <span id="catRequiredBadge" class="required-badge" style="display: none;">*</span></label>
                        <select id="editCategory" class="form-select">
                            <option value="">Selecione</option>
                            <option value="industrial">Industrial</option>
                            <option value="personalizado">Personalizado</option>
                            <option value="prototipagem">Prototipagem</option>
                            <option value="reposicao">Reposicao</option>
                            <option value="decorativo">Decorativo</option>
                            <option value="tecnico">Tecnico</option>
                        </select>
                    </div>

                    <!-- Material -->
                    <div class="form-group" id="editMaterialGroup">
                        <label><i class="fas fa-cube"></i> Material <span id="matRequiredBadge" class="required-badge" style="display: none;">*</span></label>
                        <input type="text" id="editMaterial" class="form-input" placeholder="Ex: PLA, PETG, ABS, Resina...">
                    </div>

                    <!-- Cor -->
                    <div class="form-group" id="editColorGroup">
                        <label><i class="fas fa-palette"></i> Cor <span id="colorRequiredBadge" class="required-badge" style="display: none;">*</span></label>
                        <input type="text" id="editColor" class="form-input" placeholder="Ex: Preto, Branco, Azul...">
                    </div>

                    <!-- NIVEIS DE PUBLICACAO -->
                    <div class="form-group full-width publication-levels">
                        <label><i class="fas fa-layer-group"></i> Onde Publicar</label>
                        <div class="publication-toggles three-cols">
                            <!-- Toggle Publicado -->
                            <label class="toggle-card published" id="publishedToggleCard" title="Publicar em /projetos/">
                                <input type="checkbox" id="editPublished" class="toggle-input" data-action="publication-level-change">
                                <div class="toggle-content">
                                    <div class="toggle-icon">
                                        <i class="fas fa-globe"></i>
                                    </div>
                                    <div class="toggle-switch"></div>
                                </div>
                            </label>

                            <!-- Toggle Grid Portfolio -->
                            <label class="toggle-card grid" id="gridToggleCard" title="Exibir no Grid da Home">
                                <input type="checkbox" id="editShowInGrid" class="toggle-input" data-action="publication-level-change">
                                <div class="toggle-content">
                                    <div class="toggle-icon">
                                        <i class="fas fa-th-large"></i>
                                    </div>
                                    <div class="toggle-switch"></div>
                                </div>
                            </label>

                            <!-- Toggle Destaque Hero -->
                            <label class="toggle-card featured" id="featuredToggleCard" title="Destaque no Carrossel Hero">
                                <input type="checkbox" id="editFeatured" class="toggle-input" data-action="publication-level-change">
                                <div class="toggle-content">
                                    <div class="toggle-icon">
                                        <i class="fas fa-star"></i>
                                    </div>
                                    <div class="toggle-switch"></div>
                                </div>
                            </label>
                        </div>
                        <small class="form-hint publication-status" id="publicationStatus">
                            <i class="fas fa-clock"></i> Status: <strong>QAP (Rascunho)</strong> - Salvo mas nao publicado
                        </small>
                    </div>

                    <!-- Selo NOVO -->
                    <div class="form-group full-width">
                        <label class="checkbox-label">
                            <input type="checkbox" id="editIsNew" class="form-checkbox">
                            <span class="checkbox-custom"></span>
                            <span class="checkbox-text"><i class="fas fa-certificate"></i> Marcar como NOVO</span>
                        </label>
                        <small class="form-hint">Exibe um selo "NOVO" no item</small>
                    </div>

                    <!-- Logo -->
                    <div class="form-group full-width">
                        <label><i class="fas fa-building"></i> Logo (opcional)</label>
                        <div class="image-upload-box small" id="editLogoArea">
                            <input type="file" id="editLogo" accept="image/png,image/webp" data-action="logo-select" style="display: none;">
                            <div class="upload-placeholder" id="editLogoPlaceholder">
                                <i class="fas fa-image"></i>
                                <span class="upload-text">Arraste ou clique</span>
                                <span class="upload-hint">PNG com fundo transparente</span>
                            </div>
                            <div class="image-preview hidden" id="editLogoPreview">
                                <img id="editLogoImg" src="" alt="Logo">
                                <button type="button" class="btn-remove-img" data-action="remove-logo" aria-label="Remover logo">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <input type="hidden" id="editItemId">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" data-action="close-edit-modal">
                    <i class="fas fa-times"></i> Cancelar
                </button>
                <button type="button" class="btn-primary" data-action="save-item">
                    <i class="fas fa-save"></i> Salvar
                </button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal" id="deleteModal" role="dialog" aria-modal="true" aria-labelledby="deleteModalTitle" aria-hidden="true">
        <div class="modal-content modal-sm">
            <div class="modal-header">
                <h2 id="deleteModalTitle"><i class="fas fa-trash"></i> Confirmar Exclusao</h2>
                <button class="modal-close" data-action="close-delete-modal" aria-label="Fechar modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="delete-preview">
                    <img id="deletePreviewImg" src="" alt="Item">
                    <h3 id="deleteItemTitle"></h3>
                </div>
                <div class="delete-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>Esta acao nao pode ser desfeita. As imagens serao excluidas permanentemente.</span>
                </div>
                <input type="hidden" id="deleteItemId">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" data-action="close-delete-modal">
                    <i class="fas fa-times"></i> Cancelar
                </button>
                <button type="button" class="btn-danger" data-action="confirm-delete">
                    <i class="fas fa-trash"></i> Excluir
                </button>
            </div>
        </div>
    </div>

    <!-- Gallery Modal - Fotos do Banco de Dados -->
    <div class="modal" id="galleryModal" role="dialog" aria-modal="true" aria-labelledby="galleryModalTitle" aria-hidden="true">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h2 id="galleryModalTitle"><i class="fas fa-photo-video"></i> Galeria de Fotos</h2>
                <button class="modal-close" data-action="close-gallery-modal" aria-label="Fechar modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="gallery-toolbar">
                    <div class="gallery-search">
                        <i class="fas fa-search"></i>
                        <input type="text" id="gallerySearch" placeholder="Buscar por nome do servico..." data-action="filter-gallery">
                    </div>
                    <div class="gallery-selection-info" id="gallerySelectionInfo">
                        <span id="selectedPhotosCount">0</span> foto(s) selecionada(s)
                    </div>
                </div>
                <div class="gallery-grid" id="galleryGrid">
                    <div class="gallery-loading">
                        <div class="loading-spinner"></div>
                        <p>Carregando fotos...</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" data-action="close-gallery-modal">
                    <i class="fas fa-times"></i> Cancelar
                </button>
                <button type="button" class="btn-primary" id="btnAddSelectedPhotos" data-action="add-selected-photos" disabled>
                    <i class="fas fa-plus"></i> Adicionar Selecionadas
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/12.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/12.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/12.8.0/firebase-storage-compat.js"></script>

    <!-- Config -->
    <script src="/js/env-config.js"></script>

    <!-- Logger Centralizado (Firestore) -->
    <script src="/shared/firestore-logger.js"></script>

    <!-- Custom Select - Compartilhado -->
    <script src="/shared/custom-select.js"></script>

    <!-- Main Script -->
    <script src="script.js"></script>

    <!-- Navbar Mobile - Compartilhado -->
    <script src="/shared/navbar-mobile.js"></script>
</body>
</html>
